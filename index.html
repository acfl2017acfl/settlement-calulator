<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settlement Offer Calculator</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#6b8cff;--pill:#111827}
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071026 0%, #0f1724 100%);color:#e6eef8}

    .container{max-width:920px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#6b8cff,#4dd0e1);display:flex;align-items:center;justify-content:center;font-weight:700;color:#07203a}
    h1{font-size:18px;margin:0}
    .lead{color:var(--muted);font-size:13px;margin:2px 0 0}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02)}

    label{display:block;font-size:13px;color:var(--muted);margin-bottom:8px}
    input[type=number]{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:16px}

    .controls{display:flex;gap:10px;margin-top:12px}
    .btn{flex:0 0 auto;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600;background:var(--accent);color:#04203a}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    /* Table for desktop */
    table{width:100%;border-collapse:separate;border-spacing:0 12px;margin-top:16px}
    thead th{color:var(--muted);font-size:13px;text-align:left;padding-left:12px}
    td{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px}
    .cell-amount{min-width:120px}

    .muted{color:var(--muted);font-size:13px}

    footer{margin-top:14px;color:var(--muted);font-size:13px}

    /* Responsive adjustments - STACK only on very small screens */
    @media (max-width:480px){
      .container{padding:14px}
      header{gap:10px}
      .logo{width:40px;height:40px}
      h1{font-size:16px}
      .card{padding:12px}
      input[type=number]{padding:14px;font-size:18px}
      .controls{flex-direction:column}
      .btn{width:100%;padding:12px;font-size:16px}

      /* Make table rows stack as cards on small screens only */
      table, thead, tbody, th, td, tr { display: block; }
      thead { display: none; }
      tbody { margin-top:8px; }
      tr { background: transparent; margin-bottom:12px; }
      td { position: relative; padding-left: 48%; border-radius:10px; }
      td::before {
        position: absolute;
        left: 12px;
        width: 40%;
        white-space: nowrap;
        font-weight:700;
        color:var(--muted);
      }
      /* label each cell */
      td:nth-of-type(1)::before { content: "Outstanding"; }
      td:nth-of-type(2)::before { content: "Offer"; }
      td:nth-of-type(3)::before { content: "Installment"; }
      td:nth-of-type(4)::before { content: "Total"; }
      td:nth-of-type(5)::before { content: "Discount"; }
    }

    @media (max-width:420px){
      h1{font-size:15px}
      input[type=number]{font-size:16px}
      td { padding:12px; }
    }

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">SO</div>
      <div>
        <h1>Settlement Offer Calculator</h1>
        <div class="lead">Auto-calculates 3+1, 4+1 and 6+1 offers — installments rounded up to next ₹10.</div>
      </div>
    </header>

    <div class="card">
      <label for="outstanding">Outstanding Amount (₹)</label>
      <input id="outstanding" type="number" min="0" value="32000" inputmode="numeric" pattern="[0-9]*" />

      <div class="controls">
        <button id="calc" class="btn">Recalculate</button>
        <button id="reset" class="btn secondary">Reset</button>
        <button id="download" class="btn secondary">Download CSV</button>
      </div>

      <table id="results" aria-live="polite">
        <thead>
          <tr>
            <th>Outstanding (₹)</th>
            <th>Offer</th>
            <th>Installment (₹)</th>
            <th>Total Collection (₹)</th>
            <th>Discount (₹)</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <p class="muted" style="margin-top:8px">Formula: Installment = Outstanding ÷ (PaidParts + 1), then rounded <strong>UP</strong> to next ₹10. Total Collection = Installment × PaidParts. Discount = Installment.</p>
    </div>

    <footer class="muted">Tip: On very small screens (≤480px) table rows become stacked cards for readability. Use the Download CSV button to export results.</footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const offers = [ {paid:3}, {paid:4}, {paid:6} ];

      const elOutstanding = document.getElementById('outstanding');
      const btnCalc = document.getElementById('calc');
      const btnReset = document.getElementById('reset');
      const btnDownload = document.getElementById('download');
      const tbody = document.getElementById('tbody');

      function formatINR(n){
        if (isNaN(n)) return '-';
        return new Intl.NumberFormat('en-IN', {style:'currency',currency:'INR',maximumFractionDigits:0}).format(Math.round(n));
      }

      function roundUpTo10(value){
        return Math.ceil(value / 10) * 10;
      }

      function calculateAndRender(){
        const outstanding = Number(elOutstanding.value) || 0;
        tbody.innerHTML = '';

        offers.forEach(o => {
          const paidParts = o.paid;
          const divisor = paidParts + 1;

          const instRaw = outstanding / divisor;
          const installment = roundUpTo10(instRaw);

          const totalCollection = installment * paidParts;
          const discount = installment;

          const tr = document.createElement('tr');
          tr.innerHTML = `\n            <td class="cell-amount">${formatINR(outstanding)}</td>\n            <td>${paidParts}+1</td>\n            <td>${formatINR(installment)}</td>\n            <td>${formatINR(totalCollection)}</td>\n            <td>${formatINR(discount)}</td>\n          `;
          tbody.appendChild(tr);
        });
      }

      function debounce(fn, delay){
        let t;
        return (...args) => { clearTimeout(t); t = setTimeout(()=>fn(...args), delay); };
      }

      const debouncedCalculate = debounce(calculateAndRender, 160);

      btnCalc.addEventListener('click', calculateAndRender);
      btnReset.addEventListener('click', ()=>{ elOutstanding.value=''; calculateAndRender(); });
      elOutstanding.addEventListener('input', debouncedCalculate);

      btnDownload.addEventListener('click', ()=>{
        const outstanding = Number(elOutstanding.value) || 0;
        const rows = [['Outstanding','Offer','Installment','TotalCollection','Discount']];

        offers.forEach(o=>{
          const paid = o.paid;
          const div = paid+1;
          const inst = roundUpTo10(outstanding/div);
          const tot = inst*paid;
          const disc = inst;
          rows.push([outstanding, `${paid}+1`, inst, tot, disc]);
        });

        const csv = rows.map(r => r.join(',')).join('\n');
        const blob = new Blob([csv], {type:'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'settlement_offers.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });

      calculateAndRender();
    });
  </script>
</body>
</html>
