<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settlement Offer Calculator (3+1, 4+1, 6+1) - Mobile</title>

  <style>
    :root{
      --bg:#071026;
      --panel:#0b1220;
      --muted:#98a6bf;
      --accent:#e85222;
      --glass: rgba(255,255,255,0.03);
    }

    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:#eaf2ff;
      background:linear-gradient(180deg,var(--bg) 0%, #0b1220 100%);
    }

    .wrap{max-width:420px;margin:10px auto;padding:12px}

    header{display:flex;gap:12px;align-items:center;margin-bottom:10px}
    .logo{width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(255,255,255,0.04)}
    .logo img{max-width:100%;max-height:100%;object-fit:contain}

    h1{margin:0;font-size:16px}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:12px}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      padding:12px;
      border-radius:12px;
      border:1px solid var(--glass);
      box-shadow:0 8px 28px rgba(2,6,23,0.6);
    }

    label{font-size:13px;color:var(--muted);margin-bottom:6px}

    input[type=number], input[type=date]{
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit;
      font-size:15px;
    }

    .controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}

    /* MAIN ORANGE BUTTON */
    button{
      padding:10px 12px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      font-weight:700;
      background:var(--accent);
      color:#fff;
    }

    /* GREEN RESET BUTTON */
    #reset{
      background:#28a745 !important;
    }

    /* GRAY CSV BUTTON */
    #download{
      background:#6c757d !important;
    }

    .muted{color:var(--muted);font-size:13px}

    table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:12px}
    thead th{text-align:left;color:var(--muted);font-size:13px;padding-left:10px}
    tbody tr{background:rgba(255,255,255,0.02);border-radius:8px}
    td{padding:10px;border-radius:8px;font-size:14px}
    .cell-amount{font-weight:700}

    /* Hide date & rate inputs */
    #labelDate, #firstDate, #labelRate, #annualRate {
      display:none !important;
    }

    /* Style Today’s Date box */
    #todayDisplay{
      background:var(--accent);
      color:white;
      padding:6px 10px;
      border-radius:6px;
      font-size:14px;
      font-weight:600;
    }

    /* Refresh icon style */
    #refreshIcon{
      cursor:pointer;
      background:#28a745;
      color:white;
      width:28px;
      height:28px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      font-weight:bold;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <header>
      <div class="logo">
        <img src="ACFL Logo PNG WhiteBG.png" alt="ACFL Logo" />
      </div>
      <div>
        <h1>Settlement Offer Calculator</h1>
        <p class="lead">Principal + Interest Outstanding + Future Interest → divide by (N+1)</p>
      </div>
    </header>

    <!-- TODAY’S DATE + REFRESH ICON -->
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
      <div id="todayDisplay"></div>
      <div id="refreshIcon" title="Refresh">&#10227;</div>
    </div>

    <div class="grid">
      <div>
        <div class="card">

          <label>Principal Outstanding (₹)</label>
          <input id="principal" type="number" min="0" value="0"/>

          <label style="margin-top:10px">Interest Outstanding (₹)</label>
          <input id="odToday" type="number" min="0" value="0"/>

          <!-- Hidden fixed rate -->
          <input id="annualRate" type="number" value="27" readonly/>

          <!-- Hidden date -->
          <input id="firstDate" type="date" readonly/>

          <div class="controls">
            <button id="recalc">Recalculate</button>
            <button id="reset">Reset</button>
            <button id="download">Download CSV</button>
          </div>

          <table id="results">
            <thead>
              <tr>
                <th>Outstanding (₹)</th>
                <th>Offer</th>
                <th>Installment (₹)</th>
                <th>Total Collection (₹)</th>
                <th>Discount (₹)</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>

        </div>
      </div>
    </div>

    <footer class="muted">Installment is rounded UP to nearest ₹10.</footer>
  </div>

  <script>
    function formatINR(n){
      return new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0}).format(Math.round(n));
    }

    function addMonthsKeepDay(date, months){
      const d = new Date(date.valueOf());
      const day = d.getDate();
      d.setMonth(d.getMonth() + months);
      if(d.getDate() !== day) d.setDate(0);
      return d;
    }

    function roundUp10(x){ return Math.ceil(x/10)*10; }

    function calcForN(P, OD, r, N){
      const mInt = P*r;
      const future = mInt*N;
      const total = P + OD + future;
      const inst = roundUp10(total/(N+1));
      return {
        futureOD:future,
        monthlyInterest:mInt,
        installment:inst,
        totalCollection:inst*N,
        totalOutstanding: total,
        discount:inst
      };
    }

    const elP = document.getElementById("principal");
    const elOD = document.getElementById("odToday");
    const elRate = document.getElementById("annualRate");
    const elDate = document.getElementById("firstDate");
    const tbody = document.getElementById("tbody");
    const todayDisplay = document.getElementById("todayDisplay");

    // SHOW TODAY'S DATE
    function updateToday(){
      const t = new Date();
      const dd = String(t.getDate()).padStart(2,'0');
      const mm = String(t.getMonth()+1).padStart(2,'0');
      const yyyy = t.getFullYear();
      todayDisplay.textContent = "Today's Date: " + dd + "-" + mm + "-" + yyyy;
      elDate.value = `${yyyy}-${mm}-${dd}`;
    }
    updateToday();

    function render(){
      const P = Number(elP.value)||0;
      const OD = Number(elOD.value)||0;
      const rate = 27/12/100;

      tbody.innerHTML="";

      const offers=[{label:"3+1",N:3},{label:"4+1",N:4},{label:"6+1",N:6}];

      offers.forEach(o=>{
        const r=calcForN(P,OD,rate,o.N);
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${formatINR(r.totalOutstanding)}</td>
          <td>${o.label}</td>
          <td>${formatINR(r.installment)}</td>
          <td>${formatINR(r.totalCollection)}</td>
          <td>${formatINR(r.discount)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById("recalc").onclick = render;

    // RESET = FULL PAGE RELOAD
    document.getElementById("reset").onclick = ()=> location.reload();

    // DOWNLOAD CSV
    document.getElementById("download").onclick = ()=>{
      let csv="Outstanding,Offer,Installment,TotalCollection,Discount\n";
      document.querySelectorAll("#tbody tr").forEach(row=>{
        let cols=row.querySelectorAll("td");
        csv += [
          cols[0].innerText.replace(/₹|,/g,""),
          cols[1].innerText,
          cols[2].innerText.replace(/₹|,/g,""),
          cols[3].innerText.replace(/₹|,/g,""),
          cols[4].innerText.replace(/₹|,/g,"")
        ].join(",") + "\n";
      });
      const blob=new Blob([csv],{type:"text/csv"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download="settlement_offers.csv";
      a.click();
    };

    // REFRESH ICON CLICK
    document.getElementById("refreshIcon").onclick = () => location.reload();

    render();
  </script>

</body>
</html>
