<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settlement Offer Calculator (3+1, 4+1, 6+1) - Mobile</title>
  <style>
    :root{
      --bg:#071026; /* deep navy */
      --panel:#0b1220; /* card */
      --muted:#98a6bf;
      --accent:#e85222; /* requested accent */
      --glass: rgba(255,255,255,0.03);
      --success:#4dd0e1;
      --card-grad: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#eaf2ff;background:linear-gradient(180deg,var(--bg) 0%, #0b1220 100%)}

    .wrap{max-width:420px;margin:10px auto;padding:12px}

    header{display:flex;gap:12px;align-items:center;margin-bottom:10px}
    .logo{width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.04);padding:6px}
    .logo img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    h1{margin:0;font-size:16px}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:12px;line-height:1.2}

    .card{background:var(--card-grad);padding:12px;border-radius:12px;border:1px solid var(--glass);box-shadow:0 8px 28px rgba(2,6,23,0.6)}

    .grid{display:grid;grid-template-columns:1fr;gap:12px}

    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:15px}

    .controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    button{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700;background:var(--accent);color:#fff}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:12px}
    thead th{text-align:left;color:var(--muted);font-size:13px;padding-left:10px}
    tbody tr { background: rgba(255,255,255,0.02); border-radius:8px; }
    td{padding:10px;border-radius:8px;font-size:14px}
    .cell-amount{font-weight:700}

    .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700}

    .aside-list{display:flex;flex-direction:column;gap:10px}
    .offer-card{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    .small{font-size:13px;color:var(--muted)}
    .schedule{margin-top:8px;font-size:13px;color:var(--muted)}

    footer{margin-top:12px;color:var(--muted);font-size:12px}

    /* HIDE date + rate input + labels */
    #firstDate, #labelDate, #annualRate, #labelRate {
      display:none !important;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden>
        <img src="ACFL Logo PNG WhiteBG.png" alt="ACFL Logo" />
      </div>
      <div>
        <h1>Settlement Offer Calculator</h1>
        <p class="lead">Principal + Interest Outstanding + Future Interest (per offer) → Divide by (N+1). Installments always rounded UP to next ₹10.</p>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card">
          <div id="inputs">
            <label>Principal Outstanding (₹)</label>
            <input id="principal" type="number" min="0" step="1" value="0" />

            <label style="margin-top:10px">Interest Outstanding (₹)</label>
            <input id="odToday" type="number" min="0" step="1" value="0" />

            <label id="labelRate" style="margin-top:10px">Annual Interest Rate (%)</label>
            <input id="annualRate" type="number" value="27" readonly />

            <label id="labelDate" style="margin-top:10px">First EMI Date</label>
            <input id="firstDate" type="date" readonly />

            <div class="controls">
              <button id="recalc">Recalculate</button>
              <button id="reset" class="ghost">Reset</button>
              <button id="download" class="ghost">Download CSV</button>
              <button id="copy" class="ghost">Copy Results</button>
            </div>
          </div>

          <table id="results">
            <thead>
              <tr>
                <th>Outstanding (₹)</th>
                <th>Offer</th>
                <th>Installment (₹)</th>
                <th>Total Collection (₹)</th>
                <th>Discount (₹)</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>

          <p class="muted">Formula preview: Outstanding = Principal + InterestOutstanding + (Principal × MonthlyRate × N). Installment = Total ÷ (N+1), rounded UP to next ₹10.</p>
        </div>
      </div>

      <aside>
        <div class="card aside-list">

          <div class="offer-card">
            <div style="display:flex;justify-content:space-between;">
              <div><span class="pill">3+1</span></div>
              <div class="small" id="meta31"></div>
            </div>
            <div class="schedule" id="sched31"></div>
          </div>

          <div class="offer-card">
            <div style="display:flex;justify-content:space-between;">
              <div><span class="pill">4+1</span></div>
              <div class="small" id="meta41"></div>
            </div>
            <div class="schedule" id="sched41"></div>
          </div>

          <div class="offer-card">
            <div style="display:flex;justify-content:space-between;">
              <div><span class="pill">6+1</span></div>
              <div class="small" id="meta61"></div>
            </div>
            <div class="schedule" id="sched61"></div>
          </div>

        </div>
      </aside>
    </div>

    <footer class="muted">Note: Installment is rounded <strong>up</strong> to the nearest ₹10.</footer>
  </div>

<script>
/* ================================
   UTILITY
=============================== */
function formatINR(n){
  if (isNaN(n)) return '-';
  return new Intl.NumberFormat('en-IN', {
    style:'currency',
    currency:'INR',
    maximumFractionDigits:0
  }).format(Math.round(n));
}

function addMonthsKeepDay(date, months){
  const d = new Date(date.valueOf());
  const day = d.getDate();
  d.setMonth(d.getMonth() + months);
  if (d.getDate() !== day) d.setDate(0);
  return d;
}

function roundUp10(x){
  return Math.ceil(x / 10) * 10;
}

/* ================================
   CALCULATION
=============================== */
function calcForN(principal, odToday, monthlyRate, N){
  const monthlyInterestOnPrincipal = principal * monthlyRate;
  const futureOD = monthlyInterestOnPrincipal * N;
  const total = principal + odToday + futureOD;
  const rawInstallment = total / (N + 1);
  const installment = roundUp10(rawInstallment);
  const totalCollection = installment * N;
  const discount = installment;

  return { monthlyInterestOnPrincipal, futureOD, total, rawInstallment, installment, totalCollection, discount };
}

/* ================================
   ELEMENTS
=============================== */
const elPrincipal = document.getElementById('principal');
const elOD = document.getElementById('odToday');
const elRate = document.getElementById('annualRate');
const elDate = document.getElementById('firstDate');
const tbody = document.getElementById('tbody');

const meta31 = document.getElementById('meta31');
const meta41 = document.getElementById('meta41');
const meta61 = document.getElementById('meta61');
const sched31 = document.getElementById('sched31');
const sched41 = document.getElementById('sched41');
const sched61 = document.getElementById('sched61');

/* ================================
   DATE AUTO-UPDATE (LOCAL MIDNIGHT)
=============================== */
function toLocalDateYYYYMMDD(d){
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth() + 1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}

function setDateToTodayLocal(){
  elDate.value = toLocalDateYYYYMMDD(new Date());
}

function scheduleDateAutoUpdateAtMidnight(){
  const now = new Date();
  const nextMidnight = new Date(now);
  nextMidnight.setHours(24,0,0,0);
  const msUntil = nextMidnight - now;

  setTimeout(() => {
    setDateToTodayLocal();
    renderAll();
    setInterval(() => {
      setDateToTodayLocal();
      renderAll();
    }, 24 * 60 * 60 * 1000);
  }, msUntil);
}

setDateToTodayLocal();
scheduleDateAutoUpdateAtMidnight();

/* ================================
   RENDERING
=============================== */
function buildSchedule(dateStr, N){
  const d0 = new Date(dateStr + 'T00:00:00');
  const arr = [];
  for(let i=0;i<N;i++){
    const d = addMonthsKeepDay(d0, i);
    arr.push(d.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'}));
  }
  return arr;
}

function renderAll(){
  const principal = Number(elPrincipal.value) || 0;
  const odToday = Number(elOD.value) || 0;
  const annualRate = 27; // FIXED
  const monthlyRate = annualRate / 12 / 100;
  const firstDate = elDate.value;

  const offers = [
    {label:'3+1', N:3},
    {label:'4+1', N:4},
    {label:'6+1', N:6}
  ];

  tbody.innerHTML = '';
  const rows = [];

  offers.forEach(off=>{
    const res = calcForN(principal, odToday, monthlyRate, off.N);

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="cell-amount">${formatINR(principal + odToday + res.futureOD)}</td>
      <td>${off.label}</td>
      <td>${formatINR(res.installment)}</td>
      <td>${formatINR(res.totalCollection)}</td>
      <td>${formatINR(res.discount)}</td>
    `;
    tbody.appendChild(tr);

    const metaTxt = `Future Interest: ${formatINR(res.futureOD)} • Monthly interest: ${formatINR(res.monthlyInterestOnPrincipal)}`;
    const sched = buildSchedule(firstDate, off.N);

    if(off.N===3){
      meta31.textContent = metaTxt;
      sched31.innerHTML = sched.map(s=>`• ${s}`).join('<br>');
    }
    if(off.N===4){
      meta41.textContent = metaTxt;
      sched41.innerHTML = sched.map(s=>`• ${s}`).join('<br>');
    }
    if(off.N===6){
      meta61.textContent = metaTxt;
      sched61.innerHTML = sched.map(s=>`• ${s}`).join('<br>');
    }
  });

  currentRows = rows;
}

/* ================================
   ACTIONS
=============================== */
let currentRows = [];

document.getElementById('recalc').addEventListener('click', renderAll);

document.getElementById('reset').addEventListener('click', ()=>{
  elPrincipal.value = 0;
  elOD.value = 0;
  setDateToTodayLocal();
  renderAll();
});

document.getElementById('download').addEventListener('click', ()=>{
  const header = ['Outstanding','Offer','Installment','TotalCollection','Discount'];
  const lines = [header.join(',')].concat(
    currentRows.map(r => [r.Outstanding, r.Offer, r.Installment, r.TotalCollection, r.Discount].join(','))
  );
  const csv = lines.join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'settlement_offers.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
});

document.getElementById('copy').addEventListener('click', async ()=>{
  let txt = '';
  currentRows.forEach(r=>{
    txt += `Outstanding: ${r.Outstanding}\nOffer: ${r.Offer}\nInstallment: ${r.Installment}\nTotalCollection: ${r.TotalCollection}\nDiscount: ${r.Discount}\n\n`;
  });
  await navigator.clipboard.writeText(txt);
  alert('Results copied to clipboard');
});

renderAll();
</script>
</body>
</html>
